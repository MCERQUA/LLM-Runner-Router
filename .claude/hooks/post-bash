#!/bin/bash
# Post-bash hook - runs after Claude executes bash commands

# Check exit status and provide helpful feedback
if [ "$CLAUDE_BASH_EXIT_CODE" -ne 0 ]; then
    echo "❌ Command failed with exit code: $CLAUDE_BASH_EXIT_CODE"
    
    # Provide specific guidance for common failures
    case "$CLAUDE_BASH_COMMAND" in
        *"npm test"*)
            echo "💡 Test failure - check test logs above"
            echo "🔧 Try: npm run test:watch for continuous testing"
            ;;
        *"npm install"*)
            echo "💡 Install failure - check package.json and network"
            echo "🔧 Try: npm cache clean --force && npm install"
            ;;
        *"npm start"*|*"npm run dev"*)
            echo "💡 Start failure - check port availability and dependencies"
            echo "🔧 Try: lsof -i :3000 to check port usage"
            ;;
        *"node"*)
            echo "💡 Node execution failure - check syntax and imports"
            echo "🔧 Try: node --check $file to validate syntax"
            ;;
    esac
else
    # Success cases - provide next step suggestions
    case "$CLAUDE_BASH_COMMAND" in
        *"npm install"*)
            echo "✅ Dependencies installed successfully"
            echo "💡 Next: npm run dev to start development"
            ;;
        *"npm test"*)
            echo "✅ All tests passed"
            echo "💡 Coverage report: npm run test:coverage"
            ;;
        *"npm run build"*)
            echo "✅ Build completed successfully"
            echo "💡 Check build artifacts in dist/ or build/"
            ;;
    esac
fi

# Log command execution for debugging
echo "$(date): $CLAUDE_BASH_COMMAND [exit: $CLAUDE_BASH_EXIT_CODE]" >> .claude/command-history.log