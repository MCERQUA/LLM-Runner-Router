<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * 🧠 LLM-Runner-Router Main Entry Point
 * Universal model orchestration system by Echo AI Systems
 */

import { ModelRegistry } from './core/Registry.js';
import { Router } from './core/Router.js';
import { Pipeline } from './core/Pipeline.js';
import { EngineSelector } from './engines/EngineSelector.js';
import { Logger } from './utils/Logger.js';
import { Config } from './config/Config.js';
import GGUFLoader from './loaders/GGUFLoader.js';
import MockLoader from './loaders/MockLoader.js';
import PyTorchLoader from './loaders/PyTorchLoader.js';
import BinaryLoader from './loaders/BinaryLoader.js';
import SimpleLoader from './loaders/SimpleLoader.js';
// import BitNetLoader from './loaders/BitNetLoader.js'; // Commented out - missing dependencies

const logger = new Logger('LLMRouter');

/**
 * Main LLMRouter class - The orchestrator of all model operations
 */
class LLMRouter {
  constructor(options = {}) {
    this.config = new Config(options);
    this.registry = new ModelRegistry(this.config);
    this.router = new Router(this.registry, this.config);
    this.pipeline = new Pipeline(this.config);
    this.engine = null;
    this.initialized = false;
    
    logger.info('🚀 LLM-Runner-Router initializing...', {
      version: '1.0.0',
      environment: this.detectEnvironment()
    });
  }

  /**
   * Initialize the router with automatic environment detection
   */
  async initialize() {
    if (this.initialized) return;
    
    try {
      // Auto-detect and select best engine
      this.engine = await EngineSelector.getBest(this.config);
      logger.info(`✅ Selected engine: ${this.engine.name}`);
      
      // Register format loaders
      this.registry.registerLoader('gguf', new GGUFLoader());
      logger.info('📦 Registered GGUF loader');
      
      this.registry.registerLoader('mock', new MockLoader());
      logger.info('📦 Registered Mock loader');
      
      this.registry.registerLoader('pytorch', new PyTorchLoader());
      logger.info('🔥 Registered PyTorch loader (.pth, .pt)');
      
      this.registry.registerLoader('binary', new BinaryLoader());
      logger.info('📦 Registered Binary loader (.bin)');
      
      this.registry.registerLoader('simple', new SimpleLoader());
      logger.info('🤖 Registered Simple loader (VPS fallback)');
      
      // Register BitNet loader with graceful fallback
      // Commented out - BitNetLoader has missing dependencies
      // try {
      //   this.registry.registerLoader('bitnet', new BitNetLoader({ bitnetPath: './temp/bitnet-repo' }));
      //   logger.info('📦 Registered BitNet loader (1-bit LLMs)');
      // } catch (error) {
      //   logger.warn('⚠️  BitNet loader not available - CMake may not be installed');
      // }
      
      // Initialize the registry
      await this.registry.initialize();
      logger.info(`📚 Model registry loaded: ${this.registry.getModelCount()} models`);
      
      // Setup routing strategies
      await this.router.initialize(this.engine);
      logger.info('🔄 Router initialized with strategies:', this.router.getStrategies());
      
      // Configure pipeline
      await this.pipeline.initialize(this.engine);
      logger.info('📊 Pipeline configured');
      
      this.initialized = true;
      logger.success('🎯 LLM-Runner-Router ready!');
    } catch (error) {
      logger.error('❌ Initialization failed:', error);
      throw error;
    }
  }

  /**
   * Load a model with automatic format detection
   * @param {string|object} modelSpec - Model specification
   * @returns {Model} Loaded model instance
   */
  async load(modelSpec) {
    await this.initialize();
    
    const spec = typeof modelSpec === 'string' 
      ? { source: modelSpec } 
      : modelSpec;
    
    logger.info('📦 Loading model:', spec);
    
    // Use router to find best loader
    const loader = await this.router.selectLoader(spec);
    const model = await loader.load(spec);
    
    // Register the loaded model
    this.registry.register(model);
    
    logger.success(`✅ Model loaded: ${model.id}`);
    return model;
  }

  /**
   * Quick inference with automatic model selection
   * @param {string} prompt - Input prompt
   * @param {object} options - Generation options
   */
  async quick(prompt, options = {}) {
    await this.initialize();
    
    try {
      // If a specific model is requested, try to get it
      if (options.modelId) {
        const model = await this.registry.get(options.modelId);
        if (model) {
          return this.generate(model, prompt, options);
        }
      }
      
      // Otherwise use router to select best model
      const model = await this.router.selectModel(prompt, options);
      return this.generate(model, prompt, options);
    } catch (error) {
      // If no models available, try to get any registered model
      const allModels = this.registry.getAll();
      if (allModels.length > 0) {
        const model = allModels[0];
        if (!model.loaded) {
          await model.load();
        }
        return this.generate(model, prompt, options);
      }
      throw error;
    }
  }

  /**
   * Advanced inference with full control
   * @param {object} config - Complete configuration
   */
  async advanced(config) {
    await this.initialize();
    
    const {
      prompt,
      model: modelId,
      temperature = 0.7,
      maxTokens = 500,
      stream = false,
      cache = true,
      fallbacks = []
    } = config;
    
    logger.debug('🎮 Advanced inference:', config);
    
    // Try primary model
    try {
      const model = await this.registry.get(modelId) || await this.load(modelId);
      return await this.generate(model, prompt, config);
    } catch (error) {
      logger.warn(`⚠️ Primary model failed: ${modelId}`, error);
      
      // Try fallbacks
      for (const fallback of fallbacks) {
        try {
          logger.info(`🔄 Trying fallback: ${fallback}`);
          const model = await this.registry.get(fallback) || await this.load(fallback);
          return await this.generate(model, prompt, config);
        } catch (fallbackError) {
          logger.warn(`⚠️ Fallback failed: ${fallback}`, fallbackError);
        }
      }
      
      throw new Error('All models failed');
    }
  }

  /**
   * Stream tokens in real-time
   * @param {string} prompt - Input prompt
   * @param {object} options - Streaming options
   */
  async *stream(prompt, options = {}) {
    await this.initialize();
    
    const model = await this.router.selectModel(prompt, options);
    const stream = await this.pipeline.stream(model, prompt, options);
    
    for await (const token of stream) {
      yield token;
    }
  }

  /**
   * Create model ensemble for combined inference
   * @param {array} models - Array of model configurations
   */
  async ensemble(models, prompt, options = {}) {
    await this.initialize();
    
    const results = await Promise.all(
      models.map(async ({ model: modelId, weight = 1.0 }) => {
        const model = await this.registry.get(modelId) || await this.load(modelId);
        const result = await this.generate(model, prompt, options);
        return { result, weight };
      })
    );
    
    // Weighted combination of results
    return this.combineResults(results);
  }

  /**
   * Generate response using model
   * @private
   */
  async generate(model, prompt, options) {
    return this.pipeline.process(model, prompt, options);
  }

  /**
   * Combine ensemble results
   * @private
   */
  combineResults(results) {
    // Implement weighted voting or averaging
    // This is a simplified version
    const totalWeight = results.reduce((sum, r) => sum + r.weight, 0);
    
    // For text generation, pick highest weighted
    // For embeddings, average them
    // This needs more sophisticated implementation
    return results.sort((a, b) => b.weight - a.weight)[0].result;
  }

  /**
   * Detect runtime environment
   * @private
   */
  detectEnvironment() {
    if (typeof window !== 'undefined') {
      return 'browser';
    } else if (typeof process !== 'undefined' &amp;&amp; process.versions?.node) {
      return 'node';
    } else if (typeof Deno !== 'undefined') {
      return 'deno';
    } else if (typeof WorkerGlobalScope !== 'undefined') {
      return 'worker';
    }
    return 'unknown';
  }

  /**
   * Get system status
   */
  getStatus() {
    return {
      initialized: this.initialized,
      engine: this.engine?.name,
      modelsLoaded: this.registry.getModelCount(),
      environment: this.detectEnvironment(),
      memoryUsage: process.memoryUsage?.() || {}
    };
  }

  /**
   * Cleanup and release resources
   */
  async cleanup() {
    logger.info('🧹 Cleaning up resources...');
    
    await this.pipeline.cleanup();
    await this.router.cleanup();
    await this.registry.cleanup();
    await this.engine?.cleanup();
    
    this.initialized = false;
    logger.info('✅ Cleanup complete');
  }
}

// Export main class and utilities
export { LLMRouter };
export { ModelRegistry } from './core/Registry.js';
export { Router } from './core/Router.js';
export { Pipeline } from './core/Pipeline.js';

// Create default instance
const defaultRouter = new LLMRouter();

// Export convenience methods
export const load = (spec) => defaultRouter.load(spec);
export const quick = (prompt, options) => defaultRouter.quick(prompt, options);
export const advanced = (config) => defaultRouter.advanced(config);
export const stream = (prompt, options) => defaultRouter.stream(prompt, options);
export const ensemble = (models, prompt, options) => defaultRouter.ensemble(models, prompt, options);

// Auto-initialize on import for convenience (disabled in test environment)
if (typeof process !== 'undefined' &amp;&amp; 
    process.env.AUTO_INIT !== 'false' &amp;&amp; 
    process.env.NODE_ENV !== 'test') {
  defaultRouter.initialize().catch(console.error);
}

export default LLMRouter;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="ABTestingManager.html">ABTestingManager</a></li><li><a href="AuditLogger.html">AuditLogger</a></li><li><a href="AuthMiddleware.html">AuthMiddleware</a></li><li><a href="BPETokenizer.html">BPETokenizer</a></li><li><a href="BaseEngine.html">BaseEngine</a></li><li><a href="BaseLoader.html">BaseLoader</a></li><li><a href="BinaryLoader.html">BinaryLoader</a></li><li><a href="BinaryModel.html">BinaryModel</a></li><li><a href="BitNetLoader.html">BitNetLoader</a></li><li><a href="ConversionConfig.html">ConversionConfig</a></li><li><a href="ConversionResult.html">ConversionResult</a></li><li><a href="EnterpriseAuthManager.html">EnterpriseAuthManager</a></li><li><a href="EnterpriseManager.html">EnterpriseManager</a></li><li><a href="EnterpriseRouter.html">EnterpriseRouter</a></li><li><a href="FormatConverter.html">FormatConverter</a></li><li><a href="GGUFLoader.html">GGUFLoader</a></li><li><a href="GGUFModel.html">GGUFModel</a></li><li><a href="GRPCClient.html">GRPCClient</a></li><li><a href="LLMRouter.html">LLMRouter</a></li><li><a href="MockLoader.html">MockLoader</a></li><li><a href="MockModel.html">MockModel</a></li><li><a href="ModelInterface.html">ModelInterface</a></li><li><a href="ModelQuantizer.html">ModelQuantizer</a></li><li><a href="ModelTemplates.html">ModelTemplates</a></li><li><a href="MultiTenancyManager.html">MultiTenancyManager</a></li><li><a href="PyTorchLoader.html">PyTorchLoader</a></li><li><a href="PyTorchModel.html">PyTorchModel</a></li><li><a href="QuantizationConfig.html">QuantizationConfig</a></li><li><a href="QuantizationResult.html">QuantizationResult</a></li><li><a href="Router.html">Router</a></li><li><a href="SLAMonitor.html">SLAMonitor</a></li><li><a href="SentencePieceTokenizer.html">SentencePieceTokenizer</a></li><li><a href="SimpleLoader.html">SimpleLoader</a></li><li><a href="SimpleModel.html">SimpleModel</a></li><li><a href="TokenizationResult.html">TokenizationResult</a></li><li><a href="TokenizerConfig.html">TokenizerConfig</a></li><li><a href="UniversalTokenizer.html">UniversalTokenizer</a></li><li><a href="ValidationConfig.html">ValidationConfig</a></li><li><a href="ValidationSuite.html">ValidationSuite</a></li><li><a href="ValidationSuiteResult.html">ValidationSuiteResult</a></li><li><a href="ValidationTestResult.html">ValidationTestResult</a></li><li><a href="WordPieceTokenizer.html">WordPieceTokenizer</a></li></ul><h3>Global</h3><ul><li><a href="global.html#Architectures">Architectures</a></li><li><a href="global.html#AuditEventTypes">AuditEventTypes</a></li><li><a href="global.html#AuthMethods">AuthMethods</a></li><li><a href="global.html#BreachSeverity">BreachSeverity</a></li><li><a href="global.html#Capabilities">Capabilities</a></li><li><a href="global.html#ComplianceFrameworks">ComplianceFrameworks</a></li><li><a href="global.html#EnterpriseFeatures">EnterpriseFeatures</a></li><li><a href="global.html#ExperimentStatus">ExperimentStatus</a></li><li><a href="global.html#IsolationLevels">IsolationLevels</a></li><li><a href="global.html#ModelFormat">ModelFormat</a></li><li><a href="global.html#ModelFormats">ModelFormats</a></li><li><a href="global.html#Permissions">Permissions</a></li><li><a href="global.html#QuantizationMethod">QuantizationMethod</a></li><li><a href="global.html#QuantizationPrecision">QuantizationPrecision</a></li><li><a href="global.html#QuotaTypes">QuotaTypes</a></li><li><a href="global.html#RiskLevels">RiskLevels</a></li><li><a href="global.html#RoutingStrategies">RoutingStrategies</a></li><li><a href="global.html#SLAMetricTypes">SLAMetricTypes</a></li><li><a href="global.html#SLAStatus">SLAStatus</a></li><li><a href="global.html#SessionTypes">SessionTypes</a></li><li><a href="global.html#SplittingAlgorithms">SplittingAlgorithms</a></li><li><a href="global.html#StatisticalTests">StatisticalTests</a></li><li><a href="global.html#TimeWindows">TimeWindows</a></li><li><a href="global.html#TokenizerType">TokenizerType</a></li><li><a href="global.html#UserRoles">UserRoles</a></li><li><a href="global.html#ValidationSeverity">ValidationSeverity</a></li><li><a href="global.html#ValidationTestType">ValidationTestType</a></li><li><a href="global.html#colors">colors</a></li><li><a href="global.html#createEnterpriseExpressRoutes">createEnterpriseExpressRoutes</a></li><li><a href="global.html#createEnterpriseRouter">createEnterpriseRouter</a></li><li><a href="global.html#createEnterpriseWebSocketHandlers">createEnterpriseWebSocketHandlers</a></li><li><a href="global.html#defaultEnterpriseConfig">defaultEnterpriseConfig</a></li><li><a href="global.html#enterpriseVersion">enterpriseVersion</a></li><li><a href="global.html#errorMonitoringMiddleware">errorMonitoringMiddleware</a></li><li><a href="global.html#getEnabledFeatures">getEnabledFeatures</a></li><li><a href="global.html#getMonitoringStatus">getMonitoringStatus</a></li><li><a href="global.html#httpMonitoringMiddleware">httpMonitoringMiddleware</a></li><li><a href="global.html#isFeatureEnabled">isFeatureEnabled</a></li><li><a href="global.html#recordCustomMetric">recordCustomMetric</a></li><li><a href="global.html#registerAlertRule">registerAlertRule</a></li><li><a href="global.html#registerDependency">registerDependency</a></li><li><a href="global.html#registerHealthCheck">registerHealthCheck</a></li><li><a href="global.html#setupMonitoring">setupMonitoring</a></li><li><a href="global.html#startPerformanceProfile">startPerformanceProfile</a></li><li><a href="global.html#validateEnterpriseConfig">validateEnterpriseConfig</a></li><li><a href="global.html#withCacheMonitoring">withCacheMonitoring</a></li><li><a href="global.html#withDatabaseMonitoring">withDatabaseMonitoring</a></li><li><a href="global.html#withModelMonitoring">withModelMonitoring</a></li><li><a href="global.html#withQueueMonitoring">withQueueMonitoring</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Sun Aug 17 2025 22:28:58 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
