<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: core/LoadBalancer.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: core/LoadBalancer.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * ‚öñÔ∏è Load Balancer - Quantum Distribution Harmonizer
 * Orchestrating model workloads across the computational multiverse
 * Echo AI Systems - Where every model gets its moment to shine
 */

import { Logger } from '../utils/Logger.js';

const logger = new Logger('LoadBalancer');

class LoadBalancer {
  constructor() {
    this.roundRobinIndex = 0;
    this.modelLoads = new Map();
    this.modelHistory = new Map();
    this.strategies = {
      roundRobin: this.roundRobin.bind(this),
      leastLoaded: this.leastLoaded.bind(this),
      weighted: this.weightedRandom.bind(this),
      sticky: this.stickySession.bind(this),
      adaptive: this.adaptive.bind(this)
    };
  }

  /**
   * Round-robin distribution - Everyone gets a turn
   */
  roundRobin(models) {
    if (models.length === 0) return null;
    
    const selected = models[this.roundRobinIndex % models.length];
    this.roundRobinIndex++;
    
    logger.debug(`üéØ Round-robin selected: ${selected.name}`);
    return selected;
  }

  /**
   * Least loaded model selection - The underdog gets a chance
   */
  leastLoaded(models) {
    let minLoad = Infinity;
    let selected = null;
    
    for (const model of models) {
      const load = this.modelLoads.get(model.id) || 0;
      if (load &lt; minLoad) {
        minLoad = load;
        selected = model;
      }
    }
    
    if (selected) {
      this.incrementLoad(selected.id);
      logger.debug(`‚öñÔ∏è Least loaded selected: ${selected.name} (load: ${minLoad})`);
    }
    
    return selected;
  }

  /**
   * Weighted random selection - Probabilistic fairness
   */
  weightedRandom(models, weights = null) {
    if (models.length === 0) return null;
    
    // Use provided weights or calculate based on model scores
    const modelWeights = weights || models.map(m => 
      1 / (this.modelLoads.get(m.id) || 1)
    );
    
    const totalWeight = modelWeights.reduce((sum, w) => sum + w, 0);
    let random = Math.random() * totalWeight;
    
    for (let i = 0; i &lt; models.length; i++) {
      random -= modelWeights[i];
      if (random &lt;= 0) {
        logger.debug(`üé≤ Weighted random selected: ${models[i].name}`);
        return models[i];
      }
    }
    
    return models[models.length - 1];
  }

  /**
   * Sticky sessions - Affinity for repeat customers
   */
  stickySession(models, sessionId) {
    const history = this.modelHistory.get(sessionId);
    
    if (history &amp;&amp; models.includes(history)) {
      logger.debug(`üîó Sticky session maintained: ${history.name}`);
      return history;
    }
    
    // New session or model unavailable
    const selected = this.leastLoaded(models);
    if (selected) {
      this.modelHistory.set(sessionId, selected);
    }
    
    return selected;
  }

  /**
   * Adaptive selection - Learning from patterns
   */
  adaptive(models, context = {}) {
    // Analyze context for optimal selection
    const { promptType, urgency, quality } = context;
    
    // High urgency = pick fastest
    if (urgency === 'high') {
      return this.selectFastest(models);
    }
    
    // High quality requirement = pick best scorer
    if (quality === 'high') {
      return this.selectBestQuality(models);
    }
    
    // Default to least loaded
    return this.leastLoaded(models);
  }

  /**
   * Select fastest model based on metrics
   */
  selectFastest(models) {
    return models.reduce((fastest, model) => {
      const currentLatency = model.metrics?.avgLatency || Infinity;
      const fastestLatency = fastest?.metrics?.avgLatency || Infinity;
      return currentLatency &lt; fastestLatency ? model : fastest;
    }, null);
  }

  /**
   * Select highest quality model
   */
  selectBestQuality(models) {
    return models.reduce((best, model) => {
      const currentScore = model.qualityScore || 0;
      const bestScore = best?.qualityScore || 0;
      return currentScore > bestScore ? model : best;
    }, null);
  }

  /**
   * Increment load counter for model
   */
  incrementLoad(modelId) {
    const current = this.modelLoads.get(modelId) || 0;
    this.modelLoads.set(modelId, current + 1);
    
    // Decay old loads periodically
    if (Math.random() &lt; 0.01) this.decayLoads();
  }

  /**
   * Decrease load counter after completion
   */
  decrementLoad(modelId) {
    const current = this.modelLoads.get(modelId) || 0;
    this.modelLoads.set(modelId, Math.max(0, current - 1));
  }

  /**
   * Decay load counts over time
   */
  decayLoads() {
    for (const [modelId, load] of this.modelLoads.entries()) {
      this.modelLoads.set(modelId, Math.floor(load * 0.9));
    }
  }

  /**
   * Get current load distribution
   */
  getLoadDistribution() {
    return Object.fromEntries(this.modelLoads);
  }

  /**
   * Reset all counters
   */
  reset() {
    this.roundRobinIndex = 0;
    this.modelLoads.clear();
    this.modelHistory.clear();
    logger.info('üîÑ Load balancer reset');
  }

  /**
   * Health check for models
   */
  async healthCheck(models) {
    const healthy = [];
    
    for (const model of models) {
      try {
        // Simple health check - could be more sophisticated
        if (model.loaded &amp;&amp; !model.error) {
          healthy.push(model);
        }
      } catch (error) {
        logger.warn(`‚ùå Health check failed for ${model.name}`);
      }
    }
    
    return healthy;
  }
}



export default LoadBalancer;
export { LoadBalancer };
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="ABTestingManager.html">ABTestingManager</a></li><li><a href="AuditLogger.html">AuditLogger</a></li><li><a href="AuthMiddleware.html">AuthMiddleware</a></li><li><a href="BPETokenizer.html">BPETokenizer</a></li><li><a href="BaseEngine.html">BaseEngine</a></li><li><a href="BaseLoader.html">BaseLoader</a></li><li><a href="BinaryLoader.html">BinaryLoader</a></li><li><a href="BinaryModel.html">BinaryModel</a></li><li><a href="BitNetLoader.html">BitNetLoader</a></li><li><a href="ConversionConfig.html">ConversionConfig</a></li><li><a href="ConversionResult.html">ConversionResult</a></li><li><a href="EnterpriseAuthManager.html">EnterpriseAuthManager</a></li><li><a href="EnterpriseManager.html">EnterpriseManager</a></li><li><a href="EnterpriseRouter.html">EnterpriseRouter</a></li><li><a href="ErrorHandler.html">ErrorHandler</a></li><li><a href="FormatConverter.html">FormatConverter</a></li><li><a href="GGUFLoader.html">GGUFLoader</a></li><li><a href="GGUFModel.html">GGUFModel</a></li><li><a href="GRPCClient.html">GRPCClient</a></li><li><a href="LLMRouter.html">LLMRouter</a></li><li><a href="MockLoader.html">MockLoader</a></li><li><a href="MockModel.html">MockModel</a></li><li><a href="ModelError.html">ModelError</a></li><li><a href="ModelInterface.html">ModelInterface</a></li><li><a href="ModelQuantizer.html">ModelQuantizer</a></li><li><a href="ModelRegistry.html">ModelRegistry</a></li><li><a href="ModelTemplates.html">ModelTemplates</a></li><li><a href="MultiTenancyManager.html">MultiTenancyManager</a></li><li><a href="Pipeline.html">Pipeline</a></li><li><a href="PyTorchLoader.html">PyTorchLoader</a></li><li><a href="PyTorchModel.html">PyTorchModel</a></li><li><a href="QuantizationConfig.html">QuantizationConfig</a></li><li><a href="QuantizationResult.html">QuantizationResult</a></li><li><a href="Router.html">Router</a></li><li><a href="SLAMonitor.html">SLAMonitor</a></li><li><a href="SentencePieceTokenizer.html">SentencePieceTokenizer</a></li><li><a href="SimpleLoader.html">SimpleLoader</a></li><li><a href="SimpleModel.html">SimpleModel</a></li><li><a href="TokenizationResult.html">TokenizationResult</a></li><li><a href="TokenizerConfig.html">TokenizerConfig</a></li><li><a href="UniversalTokenizer.html">UniversalTokenizer</a></li><li><a href="ValidationConfig.html">ValidationConfig</a></li><li><a href="ValidationSuite.html">ValidationSuite</a></li><li><a href="ValidationSuiteResult.html">ValidationSuiteResult</a></li><li><a href="ValidationTestResult.html">ValidationTestResult</a></li><li><a href="WordPieceTokenizer.html">WordPieceTokenizer</a></li></ul><h3>Global</h3><ul><li><a href="global.html#Architectures">Architectures</a></li><li><a href="global.html#AuditEventTypes">AuditEventTypes</a></li><li><a href="global.html#AuthMethods">AuthMethods</a></li><li><a href="global.html#BreachSeverity">BreachSeverity</a></li><li><a href="global.html#Capabilities">Capabilities</a></li><li><a href="global.html#ComplianceFrameworks">ComplianceFrameworks</a></li><li><a href="global.html#EnterpriseFeatures">EnterpriseFeatures</a></li><li><a href="global.html#ExperimentStatus">ExperimentStatus</a></li><li><a href="global.html#IsolationLevels">IsolationLevels</a></li><li><a href="global.html#ModelFormat">ModelFormat</a></li><li><a href="global.html#ModelFormats">ModelFormats</a></li><li><a href="global.html#Permissions">Permissions</a></li><li><a href="global.html#QuantizationMethod">QuantizationMethod</a></li><li><a href="global.html#QuantizationPrecision">QuantizationPrecision</a></li><li><a href="global.html#QuotaTypes">QuotaTypes</a></li><li><a href="global.html#RiskLevels">RiskLevels</a></li><li><a href="global.html#RoutingStrategies">RoutingStrategies</a></li><li><a href="global.html#SLAMetricTypes">SLAMetricTypes</a></li><li><a href="global.html#SLAStatus">SLAStatus</a></li><li><a href="global.html#SessionTypes">SessionTypes</a></li><li><a href="global.html#SplittingAlgorithms">SplittingAlgorithms</a></li><li><a href="global.html#StatisticalTests">StatisticalTests</a></li><li><a href="global.html#TimeWindows">TimeWindows</a></li><li><a href="global.html#TokenizerType">TokenizerType</a></li><li><a href="global.html#UserRoles">UserRoles</a></li><li><a href="global.html#ValidationSeverity">ValidationSeverity</a></li><li><a href="global.html#ValidationTestType">ValidationTestType</a></li><li><a href="global.html#adjustTimeouts">adjustTimeouts</a></li><li><a href="global.html#attemptRecovery">attemptRecovery</a></li><li><a href="global.html#checkConnectivity">checkConnectivity</a></li><li><a href="global.html#clearCache">clearCache</a></li><li><a href="global.html#colors">colors</a></li><li><a href="global.html#createEnterpriseExpressRoutes">createEnterpriseExpressRoutes</a></li><li><a href="global.html#createEnterpriseRouter">createEnterpriseRouter</a></li><li><a href="global.html#createEnterpriseWebSocketHandlers">createEnterpriseWebSocketHandlers</a></li><li><a href="global.html#createMissingResources">createMissingResources</a></li><li><a href="global.html#defaultEnterpriseConfig">defaultEnterpriseConfig</a></li><li><a href="global.html#emergencyShutdown">emergencyShutdown</a></li><li><a href="global.html#enterpriseVersion">enterpriseVersion</a></li><li><a href="global.html#errorMonitoringMiddleware">errorMonitoringMiddleware</a></li><li><a href="global.html#escalateError">escalateError</a></li><li><a href="global.html#executeRecovery">executeRecovery</a></li><li><a href="global.html#getEnabledFeatures">getEnabledFeatures</a></li><li><a href="global.html#getMonitoringStatus">getMonitoringStatus</a></li><li><a href="global.html#getStats">getStats</a></li><li><a href="global.html#gracefulShutdown">gracefulShutdown</a></li><li><a href="global.html#handleCriticalError">handleCriticalError</a></li><li><a href="global.html#handleMemoryLeak">handleMemoryLeak</a></li><li><a href="global.html#httpMonitoringMiddleware">httpMonitoringMiddleware</a></li><li><a href="global.html#isFeatureEnabled">isFeatureEnabled</a></li><li><a href="global.html#logError">logError</a></li><li><a href="global.html#performHealthCheck">performHealthCheck</a></li><li><a href="global.html#recordCustomMetric">recordCustomMetric</a></li><li><a href="global.html#registerAlertRule">registerAlertRule</a></li><li><a href="global.html#registerDependency">registerDependency</a></li><li><a href="global.html#registerHealthCheck">registerHealthCheck</a></li><li><a href="global.html#reinstallDependencies">reinstallDependencies</a></li><li><a href="global.html#reload">reload</a></li><li><a href="global.html#restartProcess">restartProcess</a></li><li><a href="global.html#retryConnection">retryConnection</a></li><li><a href="global.html#selectRecoveryStrategy">selectRecoveryStrategy</a></li><li><a href="global.html#setupHandlers">setupHandlers</a></li><li><a href="global.html#setupMonitoring">setupMonitoring</a></li><li><a href="global.html#softRestart">softRestart</a></li><li><a href="global.html#startHealthMonitoring">startHealthMonitoring</a></li><li><a href="global.html#startPerformanceProfile">startPerformanceProfile</a></li><li><a href="global.html#validateEnterpriseConfig">validateEnterpriseConfig</a></li><li><a href="global.html#withCacheMonitoring">withCacheMonitoring</a></li><li><a href="global.html#withDatabaseMonitoring">withDatabaseMonitoring</a></li><li><a href="global.html#withModelMonitoring">withModelMonitoring</a></li><li><a href="global.html#withQueueMonitoring">withQueueMonitoring</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Mon Aug 18 2025 01:43:35 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
